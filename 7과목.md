## ✒ 7-1. 데이터베이스 기본


### 트랜잭션

: 인가받지 않은 사용자로부터 데이터를 보장하기 위해 DBMS가 가져야 하는 특성, 데이터베이스 시스템에서 하나의 논리적 기능을 정상적으로 수행하기 위한 작업의 기본 단위

### 트랜잭션의 특성 “ACID”

1. **원자성 (Atomicity)**
    - 분해 불가능한 작업의 최소 단위
    - 연산 전체가 성공 혹은 실패
    - 하나라도 실패하면 전체가 취소되어야 함
2. **일관성 (Consistency)**
    - 트랜잭션 수행 성공 후 항상 일관된 데이터베이스 상태를 보존해야 함
3. **격리성 (Isolation)**
    - 트랜잭션 실행 중 생성하는 연산의 중간 결과를 다른 트랜잭션이 접근 불가
4. **영속성 (Durability)**
    - 성공 완료된 트랜잭션의 결과는 영속적으로 데이터 베이스에 저장
    

### 트랜잭션의 상태 변화 “활부완실철”

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/08b08806-7e0a-4389-ac33-4d5a8949b036/Untitled.png)

1. **활동 상태(Active)**
    
    : 초기 상태, 트랜잭션 실행 중인 상태
    
2. **부분 완료 상태(Partially Committed)**
    
    : 마지막 명령문이 실행된 후의 상태
    
3. **완료 상태(Committed)**
    
    : 트랜잭션이 성공적으로 완료된 후의 상태
    
4. **실패 상태(Failed)**
    
    : 정상적인 실행이 더 이상 진행될 수 없을 때의 상태
    
5. **철회 상태(Aborted)**
    
    : 트랜잭션이 취소되고 데이터베이스가 시작 전 상태로 환원된 상태
    

### 트랜잭션 제어언어(TCL : Transaction Control Language) “커롤체”

: 트랜잭션의 결과를 허용하거나 취소하는 목적으로 사용되는 언어

| 명령어 | 핵심 | 설명 |
| --- | --- | --- |
| 커밋(COMMIT) | 트랜잭션 확정 | 트랜잭션을 메모리에 영구 저장 |
| 롤백(ROLLBACK) | 트랜잭션 취소 | 트랜잭션 내역을 저장 무효화 |
| 체크포인트(CHECKPOINT) | 저장 시기 설정 | ROLLBACK을 위한 시점 지정 |

### 병행 제어(일관성 주요 기법)

: 다수 사용자 환경에서 여러 트랜잭션을 수행할 때, 데이터베이스 **일관성 유지**를 위해 상호작용을 제어하는 기법

- **병행 제어 미보장 시 문제점 “갱현모연”**
    1. **갱신 손실**
        
        : 나중에 실행된 트랜잭션이 먼저 실행된 트랜잭션 결과를 덮어쓸 때 발생하는 오류
        
    2. **현황 파악 오류**
        
        : 트랜잭션의 중간 수행 결과를 다른 트랜잭션이 참조하여 발생하는 오류
        
    3. **모순성**
        
        : 두 트랜잭션이 동시에 실행되어 데이터베이스의 일관성이 결여되는 오류
        
    4. **연쇄복귀**
        
        : 복수의 트랜잭션이 데이터 공유 시 특정 트랜잭션이 처리를 취소할 경우 트랜잭션이 처리한 곳의 부분을 취소하지 못하는 오류
        
    
- **병행 제어 기법의 종류 “로 낙타다”**
    1. **로킹**
        
        : 같은 자원을 액세스하는 다중 트랜잭션 환경에서 트랜잭션의 순차적 진행을 보장하는 직렬화 기법
        
        - 로킹 단위가 작아지면 데이터베이스 공유도 증가 & 로킹 오버헤드 증가
        - 로킹 단위란 한꺼번에 로킹할 수 있는 객체의 크기
    2. **낙관적 검증**
        
        : 트랜잭션이 어떠한 검증도 하지 않고 일단 트랜잭션 수행하고, 트랜잭션 종료 시 검증을 수행하여 데이터베이스에 반영하는 기법
        
    3. **타임 스탬프 순서**
        
        : 트랜잭션과 트랜잭션이 읽거나 갱신한 데이터에 대해 트랜잭션이 실행을 시작하기 전에 타임스탬프를 부여하여 부여된 시간에 따라 트랜잭션 작업을 수행하는 기법
        
    4. **다중버전 동시성 제어**
        
        : 트랜잭션의 타임스탬프와 접근하려는 데이터의 타임스탬프를 비교하여 직렬가능성이 보장되는 적절한 버전을 선택하여 접근하도록 하는 기법
        
    

### 데이터베이스 고립화 수준(격리성 주요 기법)

: 다른 트랜잭션이 현재의 데이터에 대한 **무결성을 해치지 않기 위해** 잠금을 설정하는 정도

- **고립화 수준 종류**
    1. **Read Uncommitted**
        
        : 한 트랜잭션에서 연산 중인 데이터를 다른 트랜잭션이 읽는 것을 허용하는 수준
        
        - 연산 중인 데이터에 대한 연산은 불허
    2. **Read Committed**
        
        : 한 트랜잭션에서 연산을 수행할 때, 완료될 때까지 연산 대상 데이터에 대한 읽기를 제한하는 수준
        
        - 완료되어 커밋된 데이터는 다른 트랜잭션이 읽는 것을 허용
    3. **Repeatable Read**
        
        : 선행 트랜잭션이 특정 데이터를 읽을 때, 트랜잭션 종료 시까지 해당 데이터에 대한 갱신 · 삭제를 제한하는 수준
        
    4. **Serializable Read**
        
        : 선행 트랜잭션이 특정 데이터를 순차적으로 읽을 때, 해당 데이터 영역 전체에 대한 접근을 제한하는 수준
        

### 회복 기법(영속성 주요 기법)

: 트랜잭션을 수행하는 도중 장애로 인해 손상된 데이터베이스를 손상되기 이전의 정상적인 상태로 **복구**시키는 작업

- **회복 기법 “회로 체그”**
    1. **로그 기반 회복 기법**
        1. **지연 갱신 회복 기법**
            
            : 트랜잭션이 완료되기 전까지 데이터베이스에 기록 X
            
        2. **즉각 갱신 회복 기법**
            
            : 트랜잭션 수행 중 갱신 결과를 바로 DB에 반영
            
    2. **체크포인트 회복 기법**
        
        : 장애 발생 시 검사점 이후에 처리된 트랜잭션에 대해서만 장애 발생 이전의 상태로 복원시키는 기법
        
    3. **그림자 페이징 회복 기법**
        
        : 데이터베이스 트랜잭션 수행 시 복제본을 생성하여 데이터베이스 장애 시 이를 이용해 복구하는 기법
        

### 데이터 정의어(DDL : Data Definition Language)

: 데이터를 정의하는 언어, 테이블과 같은 데이터 구조를 정의하는 데 사용되는 명령어

- **DDL의 대상 “도스테뷰인”**
    1. **도메인**
        
        : 하나의 속성이 가질 수 있는 원자들의 집합
        
    2. **스키마**
        
        : 데이터베이스의 구조, 제약조건 등의 정보를 담고 있는 기본적인 구조
        
        - 스키마는 외부/개념/내부 3계층으로 구성됨
        1. **외부 스키마(서브 스키마)**
            - 사용자나 개발자 관점에서의 데이터베이스의 논리적 구조
            - 사용자 뷰를 나타냄
        2. **개념 스키마**
            - 데이터베이스의 전체적인 논리 구조
            - 전체적인 뷰를 나타냄
            - 개체 간의 관계, 제약조건, 접근 권한, 보안 등에 대해 정의
        3. **내부 스키마**
            - 물리적 저장장치의 관점에서의 데이터베이스 구조
    
    1. **테이블**
        
        : 데이터 저장 공간
        
        - 릴레이션 혹은 엔터티라고도 불림
        
        - **테이블 관련 용어**
            
            
            | 튜플 / 행 | - 레코드라고도 함
            - 튜플은 릴레이션에서 같은 값을 가질 수 없음 |
            | --- | --- |
            | 애프리뷰트 / 열 | - 열의 개수를 디그리라고 함 |
            | 식별자 | - 관계형 데이터베이스에서 각각의 구분할 수 있는 논리적 개념 |
            | 카디널리티 | - 튜플의 개수 |
            | 차수 | - 애프리뷰트의 개수 |
            | 도메인 | - 하나의 애트리뷰트가 취할 수 있는 같은 타입의 원자값들의 집합 |
        
    2. **뷰**
        
        : 하나 이상의 물리 테이블에서 유도되는 가상의 테이블
        
        - 논리 테이블
        - 사용 관점에서 테이블과 동일
        - 단순 질의어 사용 가능
        - 뷰의 정의를 변경하려면 삭제 후 재생성해야 함 (변경 불가)
        
    3. **인덱스**
        
        : 검색을 빠르게 하기 위한 데이터 구조
        
        - 기본 키 컬럼은 자동으로 인덱스가 생성됨
        - 연월일이나 이름을 기준으로 하는 인덱스는 자동으로 생성되지 않음
        
        - **인덱스 종류 “순해비함 단결클”**
            1. **순서 인덱스**
                - 데이터가 정렬된 순서로 생성
                - B-Tree 알고리즘 활용(오름/내림차순 선택 가능)
            2. **해시 인덱스**
                - 해시 함수에 의해 직접 데이터에 키 값으로 접근
                - 데이터 접근 비용 균일, 튜플 양에 무관
            3. **비트맵 인덱스**
                - 각 컬럼에 적은 개수 값이 저장된 경우 선택
                - 수정 변경이 적을 경우 유용(생년월일, 상품번호 등)
            4. **함수기반 인덱스**
                - 수식이나 함수 적용하여 만듦
            5. **단일 인덱스**
                - 하나의 컬럼으로만 구성
                - 주 사용 컬럼이 하나인 경우
            6. **결합 인덱스**
                - 두개 이상의 컬럼으로 구성
                - WHERE 조건으로 사용하는 빈도가 높은 경우
            7. **클러스터드 인덱스**
                - 기본 키 기준으로 레코드를 묶어 저장
                - 저장 데이터의 물리적 순서에 따라 생성
                - 특정 범위 검색 시 유리
        
        - **인덱스 스캔 방식**
            1. 인덱스 **범위 스캔**
                
                : 루트 블록에서 리프 블록까지 수직적으로 탐색 후 리프 블록을 필요한 범위만 스캔
                
            2. 인덱스 **전체 스캔**
                
                : 인덱스 리프 블록을 처음부터 끝까지 수평적으로 탐색
                
            3. 인덱스 **단일 스캔**
                
                : 수직적 탐색만 이용
                
            4. 인덱스 **생략 스캔**
                
                : 선두 컬럼이 조건절에서 빠졌어도 인덱스를 활용
                

- **DDL 명령어 “크알드트”**
    
    
    | 생성 | CREATE | 데이터베이스 오브젝트 생성 |
    | --- | --- | --- |
    | 수정 | ALTER | 데이터베이스 오브젝트 변경 |
    | 삭제 | DROP | 데이터베이스 오브젝트 삭제 |
    | 삭제 | TRUCATE | 데이터베이스 오브젝트 내용 삭제 |
    
- **테이블 관련 DDL**
    - **테이블 생성 (CREATE TABLE)**
        
        ```sql
        CREATE TABLE 테이블명
        (
        	컬럼명 데이터타입 PRIMARY KEY, -- 기본키 설정
        	컬럼명 데이터타입 FOREIGN KEY REFERENCES 참조테이블(기본키) -- 외래키 설정
        	컬럼명 데이터타입 UNIQUE,
        	컬럼명 데이터타입 NOT NULL,
        	컬럼명 데이터타입 CHECK(조건식), -- 제약조건 설정
        	컬럼명 데이터타입 DEFAULT 값
        );
        ```
        
        - **테이블 생성 제약 조건**
            
            
            | PRIMARY KEY | - 기본 키를 정의
            - 유일하게 테이블의 각 행을 식별 |
            | --- | --- |
            | FOREIGN KEY | - 외래 키를 정의
            - 참조 대상을 테이블(컬럼명)로 명시 |
            | UNIQUE | - 테이블 내에서 얻은 유일한 값을 갖도록 함 |
            | NOT NULL | - 해당 컬럼은 NULL 값 포함하지 않도록 함 |
            | CHECK | - 개발자가 정의하는 제약조건
            - 참이어야 하는 조건을 지정 |
            | DEFAULT | - 데이터를 INSERT할 때 해당 컬럼의 값을 넣지 않는 경우 기본값으로 설정해줌 |
    - **테이블 수정 (ALTER TABLE)**
        1. **테이블에 필요한 컬럼 추가**
            - 테이블 생성 제약 조건 사용 가능
            
            ```sql
            ALTER TABLE 테이블명 ADD 컬럼명 데이터타입 [제약조건];
            ```
            
        2. **테이블에 필요한 컬럼 수정**
            
            ```sql
            ALTER TABLE 테이블명 MODIFY 컬럼명 데이터타입 [제약조건];
            ```
            
        3. **테이블에 필요한 컬럼 삭제**
            
            ```sql
            ALTER TABLE 테이블명 DROP 컬럼명;
            ```
            
    - **테이블 삭제 (DROP TABLE)**
        
        ```sql
        DROP TABLE 테이블명 [CASCADE || RESTRICT];
        ```
        
        - **명령어 옵션**
            
            
            | CASCADE | 참조하는 테이블까지 연쇄적으로 제거 |
            | --- | --- |
            | RESTRICT | 다른 테이블이 삭제할 테이블을 참조 중이면 제거하지 X |
    
    - **테이블 내의 데이터 삭제 (TRUNCATE TABLE)**
        
        ```sql
        TRUNCATE TABLE 테이블명;
        ```
        
- **VIEW 관련 DDL**
    - **뷰 생성 (CREATE VIEW)**
        
        ```sql
        CREATE VIEW 뷰이름 AS
        조회쿼리;
        ```
        
        ※ VIEW 
        
        - 예시
            
            : 사원 테이블에서 성별 값이 ‘M’을 가진 사번, 이름으로 생성된 사원뷰라는 이름의 뷰 생성
            
            ```sql
            CREATE VIEW 사원뷰 AS
            SELECT 사번, 이름
            		FROM 사원
            	WHERE 성별 = 'M';
            ```
